#!/usr/bin/env ruby

require 'optparse'
require "pp"
require 'ostruct'
require	'FileUtils'


class SulandOptParser

	def self.parse( args )

		options = OpenStruct.new
		options.verbose = true

		root = File.expand_path('../../', __FILE__ )

		option_parser = OptionParser.new do |opts|
			opts.banner = "here is help message"

			opts.on('-t', '--test', 'run all test files') do
				# find the tests under the folder `test` folder
				Dir["#{root}/test/*.rb"].each do |fileName|
					# call shell to run the tests
					system "ruby #{fileName}"
				end
			end # end '-t'

			opts.on('--clean', 'clean all extra test data') do
				deletedFiles = []
				Dir.foreach( "#{root}/test/" ) do |dirName|
					pattern = /test*/
					match = pattern =~ dirName

					pattern = /^\./
					matchHidden = pattern =~ dirName

					if matchHidden.nil? and !dirName.eql?('..') and match.nil?
						deletedFiles << dirName
						FileUtils.remove_dir( "#{root}/test/#{dirName}/" )
					end
				end
				puts "deleted files #{deletedFiles}"
			end # end '--clean'

		end  # end option_parser

		option_parser.parse!( args )
		options
	end
end # end class SulandOptParse

commandLineParser = SulandOptParser.parse( ARGV )
puts commandLineParser
